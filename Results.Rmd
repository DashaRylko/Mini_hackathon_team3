---
title: "Results"
output: html_document
date: "2025-11-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(flextable)
```

```{r}
data <- read.csv('data/CrohnD.csv')
```

## 1


```{r}

```

## 2

```{r}

```

## 3

```{r}

```

## 4. Методы однофакторного анализа.

# Возраст и число нежелательных явлений
```{r}
library(broom)
model_age <- lm(nrAdvE ~ age, data = data)

# Резюме модели с коэффициентами и доверительными интервалами
summary(model_age)
tidy_model_age <- tidy(model_age, conf.int = TRUE)
print(tidy_model_age)

# Визуализация: scatterplot с линией регрессии
ggplot(data, aes(x = age, y = nrAdvE)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = TRUE, color = "blue") +
  labs(title = "Зависимость количества осложнений от возраста",
       x = "Возраст",
       y = "Количество осложнений (НЯ)") +
  theme_minimal()
```

p-value 0.271 > 0.05, статистически не значим.

# Индекс массы тела и  число нежелательных явлений

```{r}

model_BMI <- lm(nrAdvE ~ BMI, data = data)

# Резюме модели с коэффициентами и доверительными интервалами
summary(model_BMI)
tidy_model_BMI <- tidy(model_BMI, conf.int = TRUE)
print(tidy_model_BMI)
tidy(model_BMI, conf.int = TRUE) %>%
  flextable() %>%
  set_caption("Коэффициенты регрессии с доверительными интервалами") %>%
  colformat_double(digits = 4) %>%
  bg(bg = "#F2F2F2", part = "header") %>%
  bold(part = "header")



# Визуализация: scatterplot с линией регрессии
ggplot(data, aes(x = age, y = nrAdvE)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = TRUE, color = "blue") +
  labs(title = "Зависимость количества осложнений от возраста",
       x = "Возраст",
       y = "Количество осложнений (НЯ)") +
  theme_minimal()
```

p-value 0.0363 < 0.05, статистически значим. 95% ДИ: [0.007; 0.205].
С увеличением индекса массы тела  на 1 единицу число НЯ увеличивается в среднем на 0.106 (клиническая значимость под вопросом)

# вес и число нежелательных явлений

```{r}

model_weight <- lm(nrAdvE ~ weight, data = data)

# Резюме модели с коэффициентами и доверительными интервалами
summary(model_weight)
tidy_model_weight <- tidy(model_weight, conf.int = TRUE)
print(tidy_model_weight)
tidy(model_weight, conf.int = TRUE) %>%
  flextable() %>%
  set_caption("Коэффициенты регрессии с доверительными интервалами") %>%
  colformat_double(digits = 4) %>%
  bg(bg = "#F2F2F2", part = "header") %>%
  bold(part = "header")

```

p-value 0.792 > 0.05, статистически не значим. 95% ДИ: [-0.0307; 0.0401] включает 0

# рост и число нежелательных явлений

```{r}

model_height <- lm(nrAdvE ~ height, data = data)

# Резюме модели с коэффициентами и доверительными интервалами
summary(model_height)
tidy_model_height <- tidy(model_height, conf.int = TRUE)
print(tidy_model_height)
tidy(model_height, conf.int = TRUE) %>%
  flextable() %>%
  set_caption("Коэффициенты регрессии с доверительными интервалами") %>%
  colformat_double(digits = 4) %>%
  bg(bg = "#F2F2F2", part = "header") %>%
  bold(part = "header")

```

p-value 0.012 < 0.05 - есть основания отвергнуть нулевую гипотезу
95% ДИ: [-0.128; -0.016] -  не включает 0. 
С увеличением роста на 1 см число нежелательных явлений уменьшается на 0.072 (клиническая значимость?)



# страна и число нежелательных явлений

```{r}
wilcox_result <- wilcox.test(nrAdvE ~ country, data = data, 
                            conf.int = TRUE, exact = FALSE)
print(wilcox_result)
```

p-value = 0.05814 > 0.05 - нельзя отвергнуть нулевую гипотезу 
95% ДИ: [-1.000067; 0.000021]

# пол и число нежелательных явлений

```{r}
wilcox_result_sex <- wilcox.test(nrAdvE ~ sex, data = data, 
                            conf.int = TRUE, exact = FALSE)
print(wilcox_result_sex)
```

p-value = 0.4644 > 0.05 - не можем отвергнуть нулевую гипотезу (H0) ( При условии, что H0 верна, вероятность наблюдать такие данные или ещё более крайние составляет около 47%. Высокая вероятность)

95% ДИ: [-1.99999; 0.0000248] 

# Группы лечения и число нежелательных явлений
```{r}
data <- data %>%
  mutate(
    treat = as.factor(treat),  # Преобразуем в фактор
    treat = relevel(treat, ref = "placebo")  # Устанавливаем placebo как базу
  )

model_treat <- lm(nrAdvE ~ treat, data = data)
tidy(model_treat, conf.int = TRUE)

results %>%
  flextable() %>%
  set_caption("Сравнение числа НЯ между группами лечения (база: Плацебо)") %>%
  bg(bg = "#F2F2F2", part = "header") %>%
  bold(part = "header") %>%
  colformat_double(digits = 4) %>%
  print()
```
В группе сравнения препарата 1 и плацебо p-value = 0.174 >0.05 ДИ 95% ДИ [-2.07; 0.38] (включает 0) 
не можем отвергнуть нулвую гипотезу

В группе сравнения препарата 2 и плацебо p-value = 0.649 >0.05 ДИ 95% ДИ [-1.51; 0.94] (включает 0) 
не можем отвергнуть нулвую гипотезу

Можно рассмотреть пуассоновскую регрессию

<!-- #```{r} -->
<!-- poisson_model <- glm(nrAdvE ~ treat, data = data, family = poisson) -->
<!-- summary(poisson_model) -->
<!-- poisson_results <- tidy(poisson_model, conf.int = TRUE, exponentiate = TRUE) -->


<!-- poisson_results %>% -->
<!--   flextable() %>% -->
<!--   set_caption("Пуассоновская регрессия: влияние лечения на число НЯ") %>% -->
<!--   bg(bg = "#F2F2F2", part = "header") %>% -->
<!--   bold(part = "header") %>% -->
<!--   colformat_double(digits = 4) %>% -->
<!--   print() -->
<!-- ``` -->

