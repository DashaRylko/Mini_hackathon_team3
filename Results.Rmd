---
title: "Results"
output: html_document
date: "2025-11-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
library(tidyverse)
library(ggplot2)
library(flextable)


theme_custom <- theme(
    axis.text = element_text(size = 10),
    axis.title = element_text(size = 12),
    plot.title = element_text(size = 15, hjust = 0.5),
    plot.subtitle = element_text(size = 10, hjust = 0.5),
    legend.title = element_text(size = 10),
    legend.text = element_text(size = 8),
    panel.background = element_rect(fill = "white"), 
    panel.grid = element_blank()
  )

theme_set(theme_custom) 
```

```{r}
data <- read.csv('data/CrohnD.csv')
```

## 1 Описательная статистика

Ниже представлены таблицы с описательной статистикой.
```{r}
library(officer)

statistics <- list(
  `__N/Nmiss` = ~paste0(sum(!is.na(.x)), "/", sum(is.na(.x))),
  `__Mean (SD)` = ~ifelse(sum(!is.na(.x)) == 0, "-", paste0(round(mean(.x, na.rm = TRUE), 2), " (", round(sd(.x, na.rm = TRUE), 2), ")")),
  `__Median` = ~ifelse(sum(!is.na(.x)) == 0, "-", median(.x, na.rm = TRUE) %>% round(2) %>% as.character()),
  `__Q1 - Q3` = ~ifelse(sum(!is.na(.x)) == 0, "-", paste0(quantile(.x, .25, na.rm = TRUE) %>% round(2), " - ", quantile(.x, .75, na.rm = TRUE) %>% round(2))),
  `__Min - Max` = ~ifelse(sum(!is.na(.x)) == 0, "-", paste0(min(.x, na.rm = TRUE) %>% round(2), " - ", max(.x, na.rm = TRUE) %>% round(2)))
)

data_pre <- data %>% 
  # select(treat, where(is.numeric), -c(rownames, ID)) %>% 
  group_by(treat) %>% 
  summarise(across(where(is.numeric) & !c(rownames, ID), statistics)) %>% 
  pivot_longer(!treat) %>% 
  separate(name, into = c("Variable", "Statistics"), sep="__") %>% 
  mutate(
    # Variable=str_to_upper(Variable),
    Statistics=str_remove(Statistics, "_"),
    treat=case_when(treat=="d1" ~ "Drug 1",
                    treat=="d2" ~ "Drug 2",
                    treat=="placebo" ~ "Placebo")
    ) %>%
  bind_rows(
    data %>% 
      mutate(treat="Total") %>% 
      summarise(across(where(is.numeric) & !c(rownames, ID), statistics)) %>% 
      mutate(treat="Total") %>% 
      pivot_longer(!treat) %>% 
      separate(name, into = c("Variable", "Statistics"), sep="__") %>% 
      mutate(Statistics=str_remove(Statistics, "_"))
  ) %>% 
  pivot_wider(names_from = "Variable", values_from = "value") %>% 
  relocate(treat, Statistics, age, weight, height, BMI, nrAdvE) %>% 
  rename(`Number of AE`=nrAdvE, `BMI (kg/m^2)`=BMI, `Height (cm)`=height, `Weight (kg)`=weight, `Age (years)`=age,
         `Treatment group`=treat)
  

final_table <- as_flextable(as_grouped_data(x=data_pre, groups = "Treatment group"))

border_style <- fp_border(color = "black", style = "solid", width = 1)
  
final_table <- add_footer_lines(final_table, "Abbreviations: N - not missing, Nmiss - missing, SD - standard deviation") %>%
  theme_box() %>% 
  separate_header() %>%
  bold(j=1, i=~!is.na(`Treatment group`), bold=TRUE, part = "body") %>% 
  bold(part = "header", bold = TRUE) %>% 
  colformat_double(i=~is.na(`Treatment group`), j="Statistics", digits=0, big.mark = "") %>% 
  align(i=~!is.na(`Treatment group`), align = "center") %>%
  align(align = "center", part = "body") %>% 
  align(align = "center", part = "header") %>% 
  align(j=1, i=~is.na(`Treatment group`), align = "left") %>% 
  valign(valign = "center", part = "all") %>% 
  bg(part = "header", bg = "#a9c9fc") %>% 
  bg(j=1, i=~!is.na(`Treatment group`), bg = "#EDEDED") %>% 
  border(border.top = border_style,
         border.bottom = border_style,
         border.left = border_style,
         border.right = border_style,
         part = "header") %>% 
  # merge_at(i=2, j=5:7) %>% 
  italic(part = "footer") %>% 
  set_table_properties(layout = "autofit", width = .9)%>% 
  set_caption("Таблица 1 – Описательная статистика количественных признаков", autonum = run_autonum(seq_id = "tab"), align_with_table=FALSE)

final_table
  
```
```{r}

data_tot <- data %>% 
      mutate(treat="Total")

sizes <- data_tot %>% 
  select(where(is.character), ID) %>%
  count(treat) %>%
  bind_rows(
    data %>% 
      select(where(is.character), ID) %>%
      count(treat)
  )

total_n <- sizes %>% 
  filter(treat=="Total") %>% 
  pull(n)

d1_n <- sizes %>% 
  filter(treat=="d1") %>% 
  pull(n)

d2_n <- sizes %>% 
  filter(treat=="d2") %>% 
  pull(n)

placebo_n <- sizes %>% 
  filter(treat=="placebo") %>% 
  pull(n)

data_count <- data %>% 
  select(where(is.character), ID) %>% 
  count(treat, country) %>% 
  group_by(treat) %>% 
  mutate(pct_group=(n/sum(n)) %>% round(4) %>% `*`(100) %>% str_c("%")) %>% 
  ungroup() %>% 
  mutate(variable="Country") %>%
  rename(variable_cat=country) %>% 
  bind_rows(
    data %>% 
      select(where(is.character), ID) %>% 
      count(treat, sex) %>% 
      group_by(treat) %>% 
      mutate(pct_group=(n/sum(n)) %>% round(4) %>% `*`(100) %>% str_c("%")) %>% 
      ungroup() %>% 
      mutate(variable="Sex") %>%
      rename(variable_cat=sex)
  ) %>%
  mutate(`n (%)` = paste0(n, " (", pct_group, ")"),
         treat=case_when(treat=="d1" ~ paste0("Drug 1","\n", "N = ", {{d1_n}}, "\n", "n (%)"),
                        treat=="d2" ~ paste0("Drug 2","\n", "N = ", {{d2_n}}, "\n", "n (%)"),
                        treat=="placebo" ~ paste0("Placebo","\n", "N = ", {{placebo_n}}, "\n", "n (%)"))) %>% 
  pivot_wider(id_cols = c(variable_cat, variable), names_from = treat, values_from = `n (%)`)
  

data_count_tot <- data_tot %>% 
  select(where(is.character), ID) %>% 
  count(treat, country) %>% 
  group_by(treat) %>% 
  mutate(pct_group=(n/sum(n)) %>% round(4) %>% `*`(100) %>% str_c("%")) %>%
  ungroup() %>% 
  mutate(variable="Country") %>%
  rename(variable_cat=country) %>% 
  bind_rows(
    data_tot %>% 
      select(where(is.character), ID) %>% 
      count(treat, sex) %>% 
      group_by(treat) %>% 
      mutate(pct_group=(n/sum(n)) %>% round(4) %>% `*`(100) %>% str_c("%")) %>%
      ungroup() %>% 
      mutate(variable="Sex") %>%
      rename(variable_cat=sex)
  ) %>%
  mutate(`n (%)` = paste0(n, " (", pct_group, ")"),
         treat=paste0("Total","\n", "N = ", {{total_n}}, "\n", "n (%)")) %>% 
  pivot_wider(id_cols = c(variable_cat, variable), names_from = treat, values_from = `n (%)`)

data_final <- data_count %>% 
  bind_cols(data_count_tot %>% select(-c(variable_cat, variable))) %>% 
  relocate(variable, variable_cat) %>% 
  rename(Category = variable_cat)

final_table_cat <- as_flextable(as_grouped_data(x=data_final, groups = "variable"))

border_style <- fp_border(color = "black", style = "solid", width = 1)
  
final_table_cat <- add_footer_lines(final_table_cat, "Note: Percentages are based on the number of subjects in the corresponding group. \nAbbreviations: c1 - Country 1, c2 - Country 2, F - Female, M - Male.") %>%
  theme_box() %>% 
  separate_header() %>%
  bold(j=1, i=~!is.na(variable), bold=TRUE, part = "body") %>% 
  bold(part = "header", bold = TRUE) %>% 
  colformat_double(i=~is.na(variable), j="Category", digits=0, big.mark = "") %>% 
  align(i=~!is.na(variable), align = "center") %>%
  align(align = "center", part = "body") %>% 
  align(align = "center", part = "header") %>% 
  align(j=1, i=~is.na(variable), align = "left") %>% 
  valign(valign = "center", part = "all") %>% 
  bg(part = "header", bg = "#a9c9fc") %>% 
  bg(j=1, i=~!is.na(variable), bg = "#EDEDED") %>% 
  border(border.top = border_style,
         border.bottom = border_style,
         border.left = border_style,
         border.right = border_style,
         part = "header") %>% 
  # merge_at(i=2, j=5:7) %>% 
  italic(part = "footer") %>% 
  set_table_properties(layout = "autofit", width = .9) %>% 
  set_caption("Таблица 2 – Описательная статистика категориальных признаков", autonum = run_autonum(seq_id = "tab"), align_with_table=FALSE)

final_table_cat

```


## 2 Визуализация распределений значений признаков

```{r}
library(patchwork)
```


```{r}
#Приведем типы данных
data_types <- data %>%
  select(-rownames) %>%
  mutate(across(c(country, sex, treat), as.factor),
         across(ID, as.character),
         across(c(nrAdvE, BMI, height, age, weight),as.numeric))

data_long <- data_types %>% 
  rename(
    "Количество НЯ" = nrAdvE,
    "Возраст" = age,
    "ИМТ" = BMI,
    "Рост" = height,
    "Вес" = weight
  ) %>% 
  pivot_longer(cols = where(is.numeric), names_to = "variable", values_to = "value")

```

### Анализ количественных переменных

```{r fig.width = 7, fig.height=4}
# Строим гистограммы
ggplot(data_long, aes(x = value, fill = variable)) +
  geom_histogram(bins = 30, alpha = 0.6, color = "black") +
  facet_wrap(~variable, scales = 'free') +
  labs(title = "Распределения количественных признаков",
       x = "Значение", y = "Частота", fill = "Количественная\nпеременная")
  
```
Из данных графиков видим, что признак количество НЯ распределен скошенным образом и дискретно

#### Приведены графики для оценки средних и 95% ДИ для различных количественных признаков

```{r fig.width = 7, fig.height=4}
se <- function(x) {
  sd(x, na.rm = TRUE) / sqrt(length(x))
}

age_plot <- data_types %>%
  group_by(treat) %>%
  summarise(
    mean_age = mean(age),
    sd = sd(age),
    se = se(age),
    ci_95_min = mean_age - 1.96 * se,
    ci_95_max = mean_age + 1.96 * se
  ) %>%
  ggplot() +
  geom_point(aes(x = treat, y = mean_age, color = treat)) +
  geom_errorbar(aes(
    x = treat,
    y = mean_age,
    ymin = ci_95_min,
    ymax = ci_95_max, color = treat
  ), width = 0.5)+
     scale_color_brewer(palette = "Set2")+
  labs(x = "Тип лечения", y = "Среднее возраста",color = "Лечение")

BMI_plot <- data_types %>%
  group_by(treat) %>%
  summarise(
    mean_BMI = mean(BMI),
    sd = sd(BMI),
    se = se(BMI),
    ci_95_min = mean_BMI - 1.96 * se,
    ci_95_max = mean_BMI + 1.96 * se
  ) %>%
  ggplot() +
  geom_point(aes(x = treat, y = mean_BMI, color = treat)) +
  geom_errorbar(aes(
    x = treat,
    y = mean_BMI,
    ymin = ci_95_min,
    ymax = ci_95_max, color = treat
  ), width = 0.5)+
     scale_color_brewer(palette = "Set2")+
  labs(x = "Тип лечения", y = "Среднее ИМТ",color = "Лечение")

height_plot <- data_types %>%
  group_by(treat) %>%
  summarise(
    mean_height = mean(height),
    sd = sd(height),
    se = se(height),
    ci_95_min = mean_height - 1.96 * se,
    ci_95_max = mean_height + 1.96 * se
  ) %>%
  ggplot() +
  geom_point(aes(x = treat, y = mean_height, color = treat)) +
  geom_errorbar(aes(
    x = treat,
    y = mean_height,
    ymin = ci_95_min,
    ymax = ci_95_max, color = treat
  ), width = 0.5)+
     scale_color_brewer(palette = "Set2")+
  labs(x = "Тип лечения", y = "Среднее роста",color = "Лечение")

weight_plot <- data_types %>%
  group_by(treat) %>%
  summarise(
    mean_weight = mean(weight),
    sd = sd(weight),
    se = se(weight),
    ci_95_min = mean_weight - 1.96 * se,
    ci_95_max = mean_weight + 1.96 * se
  ) %>%
  ggplot() +
  geom_point(aes(x = treat, y = mean_weight, color = treat)) +
  geom_errorbar(aes(
    x = treat,
    y = mean_weight,
    ymin = ci_95_min,
    ymax = ci_95_max, color = treat
  ), width = 0.5)+
     scale_color_brewer(palette = "Set2")+
  labs(x = "Тип лечения", y = "Среднее веса",color = "Лечение")

res_plot <- (age_plot|BMI_plot) / (height_plot|weight_plot)

wrap_plots(res_plot) +
  plot_annotation(title = "95% интервалы распределения количественных переменных",
                  subtitle = "по группам лечения")
```
С помощью данного графика можем оценить различия в значениях количественных переменных по разным группам лечения.

### Анализ номинативных переменнных

```{r fig.width = 7, fig.height=4}
(ggplot(data_types, aes(x = treat,fill = treat)) +
  geom_bar(position = position_dodge(width = 0.8), width = 0.7, color = 'black') +
  labs(title = "Распределение по типу лечения",
       x = "Лечение", y = "Частота")+
  scale_fill_brewer(palette = "Set2"))/
((ggplot(data_types, aes(x = country, fill = treat)) +
  geom_bar(position = position_dodge(width = 0.8), width = 0.7, color = 'black')+
  labs(title = "Распределение по странам",
       x = "Страна", y = "Частота", fill = "Лечение")+
  scale_fill_brewer(palette = "Set2"))|  
(ggplot(data_types, aes(x = sex, fill = treat)) +
  geom_bar(position = position_dodge(width = 0.8), width = 0.7, color = 'black') +
  labs(title = "Распределение по полу",
       x = "Пол", y = "Частота", fill = "Лечение")+
  scale_fill_brewer(palette = "Set2")))


```
Из графиков видим, что группы распределены достаточно равномерно

### Анализ основного показателя (количество НЯ)

```{r fig.width = 8, fig.height=3}
(
  ggplot(data_types, aes(
    x = treat, y = nrAdvE, fill = treat
  )) +
    geom_boxplot(width = 0.5) +
    geom_jitter(width = 0.2) +
    theme_minimal() +
    labs(
      title = "Количество НЯ по типу лечения",
      x = "Тип лечения",
      y = "Количество НЯ",
      fill = "Лечение"
    ) +
    scale_fill_brewer(palette = "Set2")
)|
  (data_types %>%
     group_by(treat) %>%
     summarise(
       mean_nrAdvE = mean(nrAdvE),
       sd = sd(nrAdvE),
       se = se(nrAdvE),
       ci_95_min = mean_nrAdvE - 1.96 * se,
       ci_95_max = mean_nrAdvE + 1.96 * se
     ) %>%
     ggplot() +
     geom_point(aes(x = treat, y = mean_nrAdvE, color = treat)) +
     geom_errorbar(aes(
       x = treat,
       y = mean_nrAdvE,
       ymin = ci_95_min,
       ymax = ci_95_max,
       color = treat
     ), width = 0.5)+
     scale_color_brewer(palette = "Set2")+
     labs(title = "95% ДИ для среднего количества НЯ",
          x = "Тип лечения", y = "Среднее",color = "Лечение")+
     theme_minimal())
```
Из графика можно оценить распределение данной переменной. Также можем увидеть разницу в оценке среднего количества НЯ для разных групп лечения.


## 3 Визуальная оценка взаимосвязи между числом НЯ и собранными признаками пациентов

```{r}
#распределение числа НЯ

data %>% 
  ggplot()+
  geom_bar(aes(x = as.factor(nrAdvE)), fill = 'seagreen', colour = 'black')+
  labs(
    title = 'Распределение числа НЯ у пациентов',
    x = 'Количество НЯ',
    y = 'Количество пациентов'
  )+
  coord_cartesian(ylim = c(0, 49))+
  scale_y_continuous(breaks=seq(0,50,5))+
  theme(
    panel.grid.major.y = element_line(colour = 'grey90'),
    panel.grid.minor.y = element_line(colour = 'grey90')
  )
```


```{r fig.width=15, fig.height=5}
#распреление кол-ва НЯ в зависимости от пола и типа лечения и страны

bb1 <- data %>% 
  group_by(treat) %>% 
  summarise(
    'Среднее' = mean(nrAdvE)
  )

b1 <- data %>% 
  ggplot()+
  geom_violin(aes(x = treat, y = nrAdvE), fill = 'lightblue4', alpha =0.7)+
  geom_boxplot(aes(x = treat, y = nrAdvE), width=0.1)+
  geom_point(data = bb1, aes(x = treat, y = Среднее), shape = 23, size = 5, fill = 'brown3', colour = 'grey40')+
  scale_y_continuous(breaks = seq(0,12,1))+
  scale_x_discrete(labels= c(
    'placebo' = 'Плацебо',
    'd1' = 'Препарат 1',
    'd2' = 'Препарат 2'
  ) )+
  labs(
    y = 'Количество НЯ',
    x = 'Тип лечения'
  )+
  theme(
    panel.grid.major.y = element_line(colour = 'grey90'),
    panel.grid.minor.y = element_line(colour = 'grey90')
  )

bb2 <- data %>% 
  group_by(sex) %>% 
  summarise(
    'Среднее' = mean(nrAdvE)
  )  

b2 <- data %>% 
  ggplot(aes(x = sex, y = nrAdvE))+
  geom_violin(fill = 'sienna3', alpha =0.7)+
  geom_boxplot(width=0.1)+
  geom_point(data = bb2, aes(x = sex, y = Среднее), shape = 23, size = 5, fill = 'brown3', colour = 'grey40')+
  theme(
    axis.text.y = element_blank(),
    axis.title.y = element_blank(),
    axis.ticks.y = element_blank()
  )+
  scale_y_continuous(breaks = seq(0,12,1))+
  scale_x_discrete(labels= c(
    'F' = 'Женщина',
    'M' = 'Мужчина'))+
  labs(
    x = 'Пол'
  )+
  theme(
    panel.grid.major.y = element_line(colour = 'grey90'),
    panel.grid.minor.y = element_line(colour = 'grey90')
  )

bb3 <- data %>% 
  group_by(country) %>% 
  summarise(
    'Среднее' = mean(nrAdvE)
  )   

b3 <- data %>% 
  ggplot(aes(x = country, y = nrAdvE))+
  geom_violin(fill = 'mediumpurple4', alpha =0.7)+
  geom_boxplot(width=0.1)+
  geom_point(data = bb3, aes(x = country, y = Среднее), shape = 23, size = 5, fill = 'brown3', colour = 'grey40')+
  theme(
    axis.text.y = element_blank(),
    axis.title.y = element_blank(),
    axis.ticks.y = element_blank()
  )+
  scale_y_continuous(breaks = seq(0,12,1))+
  scale_x_discrete(labels= c(
    'c1' = 'Страна 1',
    'c2' = 'Страна 2'))+
  labs(
    x = 'Страна'
  )+
  theme(
    panel.grid.major.y = element_line(colour = 'grey90'),
    panel.grid.minor.y = element_line(colour = 'grey90')
  )



(b1 | b2 | b3) +
  plot_annotation(
    title = "Распределение количества НЯ в зависимости от лечения, пола и страны пациента",
    caption = 'Примечание: ромбом обозначены средние значения баллов',
    theme = theme(plot.title = element_text(hjust = 0.5, size = 20)))
```

```{r}
#Взаимосвязь возраста пациента и кол-ва НЯ
data %>% 
  ggplot(aes(y = nrAdvE, x = age, colour = treat))+
  geom_point()+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_y_continuous(breaks=seq(0,12,2))+
  scale_x_continuous(breaks=seq(20,75,5))+
  scale_colour_manual(
    name = 'Тип лечения',
    labels = c('placebo' = 'Плацебо',
               'd1' = 'Препарат 1',
               'd2' = 'Препарат 2'),
    values = c('placebo' = 'grey40',
               'd1' = 'seagreen',
               'd2' = 'tan3')
  )+
  labs(
    title = 'Взаимосвязь возраста пациента и количества НЯ',
    x = 'Возраст',
    y = 'Количество НЯ'
  )+
  theme(
    panel.grid = element_line(colour = 'grey90')
  )
```

```{r}
#Взаимосвязь ИМТ пациента и кол-ва НЯ
data %>% 
  ggplot(aes(y = nrAdvE, x = BMI, colour  = treat))+
  geom_point()+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_y_continuous(breaks=seq(0,12,2))+
  scale_colour_manual(
    name = 'Тип лечения',
    labels = c('placebo' = 'Плацебо',
    'd1' = 'Препарат 1',
    'd2' = 'Препарат 2'),
    values = c('placebo' = 'grey40',
    'd1' = 'seagreen',
    'd2' = 'tan3')
  )+
  labs(
    title = 'Взаимосвязь ИМТ пациента и количества НЯ',
    x = 'ИМТ',
    y = 'Количество НЯ'
  )+
  theme(
    panel.grid = element_line(colour = 'grey90')
  )
```


## 4 Однофакторный анализ

```{r}
#Количество НЯ и тип лечения
library(broom)

```
```{r}
# Пуассоновская регрессия

data_types$treat <- relevel(data_types$treat, ref = "placebo")

model_treat <- glm(nrAdvE ~ treat, data = data_types, family = 'poisson')

tidy_model_age <- tidy(model_treat, conf.int = TRUE) %>% 
  mutate(across(c(estimate, std.error, statistic, conf.low, conf.high, p.value), 
                ~ round(.x, 3)))
tidy_model_age %>% 
  flextable() %>% 
  set_table_properties(layout= "autofit",width=.9)
```


```{r}
#Количество НЯ и Возраст, Рост, Вес, ИМТ

cor_test_age <- cor.test(data_types$nrAdvE, data$age, method = "spearman")
cor_test_height <- cor.test(data_types$nrAdvE, data$height, method = "spearman")
cor_test_weight <- cor.test(data_types$nrAdvE, data$weight, method = "spearman")
cor_test_BMI <- cor.test(data_types$nrAdvE, data$BMI, method = "spearman")

cor_test_res <- rbind(`Количество НЯ и возраст` = data.frame(
  Correlation = cor_test_age$estimate,
  S_statistic = cor_test_age$statistic,
  p_value = cor_test_age$p.value
),
`Количество НЯ и рост` = data.frame(
  Correlation = cor_test_height$estimate,
  S_statistic = cor_test_height$statistic,
  p_value = cor_test_height$p.value
),
`Количество НЯ и вес` = data.frame(
  Correlation = cor_test_weight$estimate,
  S_statistic = cor_test_weight$statistic,
  p_value = cor_test_weight$p.value
),
`Количество НЯ и ИМТ` = data.frame(
  Correlation = cor_test_BMI$estimate,
  S_statistic = cor_test_BMI$statistic,
  p_value = cor_test_BMI$p.value
))
rownames_to_column(cor_test_res, var = "Переменные") %>% 
  mutate(across(c(Correlation, S_statistic, p_value),~round(.x,3))) %>% 
  flextable() %>% 
  set_table_properties(layout= "autofit",width=.9)

```
```{r}
#Количество НЯ и пол, страна

ttest_country <- t.test(nrAdvE ~ country, data = data_types)
ttest_sex <- t.test(nrAdvE ~ sex, data = data_types)

table_res_country <- data.frame(
  t_statistic = ttest_country$statistic,
  df = ttest_country$parameter,
  p_value = ttest_country$p.value,
  CI_lower = ttest_country$conf.int[1],
  CI_upper = ttest_country$conf.int[2]
)
table_res_sex <- data.frame(
  t_statistic = ttest_sex$statistic,
  df = ttest_sex$parameter,
  p_value = ttest_sex$p.value,
  CI_lower = ttest_sex$conf.int[1],
  CI_upper = ttest_sex$conf.int[2]
)
t_test_res <- rbind(`Количество НЯ и страна` = table_res_country,
                    `Количество НЯ и пол` = table_res_sex)

t_test_res %>%
  rownames_to_column(var = "Переменные") %>%
  mutate(across(c(
    t_statistic, df, p_value, CI_lower, CI_upper
  ),  ~ round(.x, 3))) %>%
  flextable() %>%
  set_table_properties(layout = "autofit", width = .9)
```




